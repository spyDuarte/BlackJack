(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();function b(d){return d?d.value==="A"?11:["J","Q","K"].includes(d.value)?10:parseInt(d.value):0}function E(d){let e=0,t=0;if(!d||!Array.isArray(d))return{value:0,isSoft:!1,aces:0};for(const s of d){if(!s)continue;const i=b(s);e+=i,i===11&&t++}for(;e>21&&t>0;)e-=10,t--;return{value:e,isSoft:t>0,aces:t}}function m(d){return E(d).value}function S(d){return E(d).isSoft}function v(d,e){return!d||!Array.isArray(d)||d.length!==2||e>1?!1:m(d)===21}const k=Object.freeze(Object.defineProperty({__proto__:null,calculateHandValue:m,getCardNumericValue:b,getHandStats:E,isNaturalBlackjack:v,isSoftHand:S},Symbol.toStringTag,{value:"Module"}));class C{static getBestMove(e,t){if(!e||!e.cards||e.cards.length===0||!t)return"stand";const s=m(e.cards),i=S(e.cards),n=b(t);if(e.cards.length===2&&e.cards[0].value===e.cards[1].value){const a=b(e.cards[0]);if(a===11)return"split";if(a===10)return"stand";if(a===9)return n===7||n===10||n===11?"stand":"split";if(a===8||a===7&&n>=2&&n<=7||a===6&&n>=2&&n<=6)return"split";if(a===4)return n===5||n===6?"split":"hit";if((a===2||a===3)&&n>=2&&n<=7)return"split"}return i?s>=19?"stand":s===18?n>=3&&n<=6?"double":n===2||n===7||n===8?"stand":"hit":s===17?n>=3&&n<=6?"double":"hit":s===15||s===16?n>=4&&n<=6?"double":"hit":(s===13||s===14)&&(n===5||n===6)?"double":"hit":s>=17?"stand":s>=13&&s<=16?n>=2&&n<=6?"stand":"hit":s===12?n>=4&&n<=6?"stand":"hit":s===11?"double":s===10?n<10?"double":"hit":s===9&&n>=3&&n<=6?"double":"hit"}}const h={DECKS:6,PENETRATION_THRESHOLD:.2,INITIAL_BALANCE:1e3,MIN_BET:10,MAX_SPLITS:3,ANIMATION_SPEED:500,STORAGE_VERSION:2,PAYOUT:{BLACKJACK:2.5,REGULAR:2,INSURANCE:3},DELAYS:{DEAL:500,TURN:500,DEALER_TURN:500,GAME_OVER:750,RESET:2e3,NEXT_HAND:250,LOADING:400,INSURANCE_MODAL:1e3}};function B(d,e){let t;return function(...s){const i=this;clearTimeout(t),t=setTimeout(()=>d.apply(i,s),e)}}class A{constructor(){this.elements={},this.animationsEnabled=!0,this.game=null}initialize(e){this.game=e,this.cacheElements(),this.bindEvents(),this.toggleLoading(!1)}cacheElements(){this.elements={balance:document.getElementById("balance"),currentBet:document.getElementById("current-bet"),wins:document.getElementById("wins"),losses:document.getElementById("losses"),dealerCards:document.getElementById("dealer-cards"),playerCards:document.getElementById("player-cards"),dealerScore:document.getElementById("dealer-score"),playerScore:document.getElementById("player-score"),message:document.getElementById("message"),betControls:document.getElementById("bet-controls"),gameControls:document.getElementById("game-controls"),betInput:document.getElementById("bet-input"),betBtn:document.getElementById("bet-btn"),hitBtn:document.getElementById("hit-btn"),standBtn:document.getElementById("stand-btn"),doubleBtn:document.getElementById("double-btn"),newGameBtn:document.getElementById("new-game-btn"),betDecrease:document.getElementById("bet-decrease"),betIncrease:document.getElementById("bet-increase"),betDoubleValue:document.getElementById("bet-double-value"),betMaxValue:document.getElementById("bet-max-value"),splitBtn:document.getElementById("split-btn"),settingsBtn:document.getElementById("settings-btn"),settingsModal:document.getElementById("settings-modal"),insuranceModal:document.getElementById("insurance-modal"),insuranceYesBtn:document.getElementById("insurance-yes-btn"),insuranceNoBtn:document.getElementById("insurance-no-btn"),surrenderBtn:document.getElementById("surrender-btn"),hintBtn:document.getElementById("hint-btn"),rebetBtn:document.getElementById("rebet-btn"),statsContainer:document.getElementById("stats-container"),loading:document.querySelector(".loading"),welcomeScreen:document.getElementById("welcome-screen"),errorNotification:document.getElementById("error-notification"),errorMessage:document.getElementById("error-message"),closeError:document.querySelector(".close-error"),totalGames:document.getElementById("total-games"),winRate:document.getElementById("win-rate"),totalWinnings:document.getElementById("total-winnings"),blackjacks:document.getElementById("blackjacks"),startBtn:document.getElementById("start-game-btn"),btnReset:document.getElementById("btn-reset-game"),closeSettings:document.querySelector(".close"),loginScreen:document.getElementById("login-screen"),loginUsername:document.getElementById("login-username"),loginBtn:document.getElementById("login-btn"),loginError:document.getElementById("login-error"),volumeSlider:document.getElementById("volume-slider"),volumeValue:document.getElementById("volume-value"),themeDark:document.getElementById("theme-dark"),themeLight:document.getElementById("theme-light"),exportBtn:document.getElementById("btn-export-data"),importInput:document.getElementById("btn-import-data"),toastContainer:document.getElementById("toast-container"),shoeBar:document.getElementById("shoe-bar"),shoeLabel:document.getElementById("shoe-label")}}bindEvents(){const e=this.elements,t=this.game;e.loginBtn&&e.loginBtn.addEventListener("click",()=>this.handleLogin()),e.loginUsername&&e.loginUsername.addEventListener("keypress",n=>{n.key==="Enter"&&this.handleLogin()}),e.startBtn&&e.startBtn.addEventListener("click",()=>t.startApp()),e.btnReset&&e.btnReset.addEventListener("click",()=>t.resetGame()),e.betBtn&&e.betBtn.addEventListener("click",()=>t.startGame()),e.hitBtn&&e.hitBtn.addEventListener("click",()=>t.hit()),e.standBtn&&e.standBtn.addEventListener("click",()=>t.stand()),e.doubleBtn&&e.doubleBtn.addEventListener("click",()=>t.double()),e.splitBtn&&e.splitBtn.addEventListener("click",()=>t.split()),e.surrenderBtn&&e.surrenderBtn.addEventListener("click",()=>t.surrender()),e.hintBtn&&e.hintBtn.addEventListener("click",()=>this.showHint()),e.insuranceYesBtn&&e.insuranceYesBtn.addEventListener("click",()=>t.respondToInsurance(!0)),e.insuranceNoBtn&&e.insuranceNoBtn.addEventListener("click",()=>t.respondToInsurance(!1)),e.newGameBtn&&e.newGameBtn.addEventListener("click",()=>t.newGame()),e.rebetBtn&&e.rebetBtn.addEventListener("click",()=>t.rebetAndDeal()),e.betDecrease&&e.betDecrease.addEventListener("click",()=>t.adjustBet(-10)),e.betIncrease&&e.betIncrease.addEventListener("click",()=>t.adjustBet(10)),e.betDoubleValue&&e.betDoubleValue.addEventListener("click",()=>t.multiplyBet(2)),e.betMaxValue&&e.betMaxValue.addEventListener("click",()=>t.maxBet()),e.betInput&&(e.betInput.addEventListener("change",n=>t.setBet(parseInt(n.target.value))),e.betInput.addEventListener("keypress",n=>{n.key==="Enter"&&t.startGame()}));const s=document.querySelectorAll(".chip"),i=n=>{const a=parseInt(n.target.dataset.value);t.setBet(a),n.target.style.transform="scale(1.3)",setTimeout(()=>{n.target.style.transform=""},200)};s.forEach(n=>{n.addEventListener("click",i),n.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i(a))})}),e.settingsBtn&&e.settingsBtn.addEventListener("click",()=>this.toggleSettingsModal(!0)),e.closeSettings&&e.closeSettings.addEventListener("click",()=>this.toggleSettingsModal(!1)),window.addEventListener("click",n=>{n.target===e.settingsModal&&this.toggleSettingsModal(!1)}),this.bindCheckbox("sound-enabled",n=>t.updateSetting("soundEnabled",n)),this.bindCheckbox("animations-enabled",n=>t.updateSetting("animationsEnabled",n)),this.bindCheckbox("auto-save",n=>t.updateSetting("autoSave",n)),this.bindCheckbox("show-stats",n=>t.updateSetting("showStats",n)),e.volumeSlider&&e.volumeSlider.addEventListener("input",n=>{const a=parseInt(n.target.value);e.volumeValue&&(e.volumeValue.textContent=`${a}%`),t.updateSetting("volume",a/100)}),e.themeDark&&e.themeDark.addEventListener("click",()=>this.setTheme("dark")),e.themeLight&&e.themeLight.addEventListener("click",()=>this.setTheme("light")),e.exportBtn&&e.exportBtn.addEventListener("click",()=>t.exportData()),e.importInput&&e.importInput.addEventListener("change",n=>{const a=n.target.files[0];a&&t.importData(a),n.target.value=""}),document.addEventListener("keydown",n=>this.handleKeyboard(n)),window.addEventListener("resize",B(()=>{this.game&&this.game.updateUI()},250)),e.closeError&&e.closeError.addEventListener("click",()=>this.hideError())}sanitizeUsername(e){return e.replace(/[^a-zA-Z0-9_\-\u00C0-\u024F]/g,"").slice(0,20)}handleLogin(){const e=this.elements.loginUsername.value.trim();if(!e){this.showLoginError("Por favor, digite um nome de usuário.");return}const t=this.sanitizeUsername(e);if(t.length<3){this.showLoginError("Nome de usuário deve ter pelo menos 3 caracteres (apenas letras, números e _).");return}this.game.login(t),this.elements.loginScreen&&(this.elements.loginScreen.classList.add("hidden"),setTimeout(()=>{this.elements.loginScreen.style.display="none",this.elements.welcomeScreen&&(this.elements.welcomeScreen.style.display="flex",this.elements.welcomeScreen.classList.remove("hidden"))},500))}showLoginError(e){this.elements.loginError&&(this.elements.loginError.textContent=e,this.elements.loginUsername.classList.add("error"),setTimeout(()=>this.elements.loginUsername.classList.remove("error"),500))}bindCheckbox(e,t){const s=document.getElementById(e);s&&s.addEventListener("change",i=>{t(i.target.checked)})}handleKeyboard(e){if(e.key==="Escape"){this.toggleSettingsModal(!1);return}if(!this.elements.gameControls||this.elements.gameControls.style.display==="none")return;const s={h:{action:()=>this.game.hit(),btn:this.elements.hitBtn},s:{action:()=>this.game.stand(),btn:this.elements.standBtn},d:{action:()=>this.game.double(),btn:this.elements.doubleBtn},p:{action:()=>this.game.split(),btn:this.elements.splitBtn},r:{action:()=>this.game.surrender(),btn:this.elements.surrenderBtn}}[e.key.toLowerCase()];s&&(s.action(),s.btn&&!s.btn.disabled&&s.btn.style.display!=="none"&&(s.btn.classList.add("kbd-active"),setTimeout(()=>s.btn.classList.remove("kbd-active"),150)))}render(e){if(!e)return;this.clearHint(),this.elements.balance&&this.animateValue(this.elements.balance,e.balance,"$"),this.elements.currentBet&&this.animateValue(this.elements.currentBet,e.currentBet,"$"),this.elements.wins&&this.animateValue(this.elements.wins,e.wins),this.elements.losses&&this.animateValue(this.elements.losses,e.losses),this.elements.betInput&&(this.elements.betInput.value=e.currentBet),this.renderHand(this.elements.dealerCards,e.dealerHand,!0,e.dealerRevealed),this.renderPlayerHands(e.playerHands,e.currentHandIndex);const t=e.dealerHand&&e.dealerHand.length>0?m(e.dealerRevealed?e.dealerHand:[e.dealerHand[0]]):0;let s=0;if(e.playerHands&&e.playerHands.length>0&&e.playerHands[e.currentHandIndex]&&(s=m(e.playerHands[e.currentHandIndex].cards)),this.elements.dealerScore&&(this.elements.dealerScore.textContent=e.dealerRevealed?t:"?"),this.elements.playerScore&&(this.elements.playerScore.textContent=s),this.updateStats(e.wins,e.losses,e.totalWinnings,e.blackjacks),e.playerHands.length>0&&!e.gameOver){const i=e.playerHands[e.currentHandIndex],n=i.cards.length===2&&i.cards[0].value===i.cards[1].value&&e.balance>=i.bet&&e.playerHands.length<=h.MAX_SPLITS;this.elements.splitBtn&&(this.elements.splitBtn.style.display=n?"inline-block":"none",this.elements.splitBtn.disabled=!n);const a=i.cards.length===2&&e.playerHands.length===1&&i.status==="playing";if(this.elements.surrenderBtn&&(this.elements.surrenderBtn.style.display=a?"inline-block":"none",this.elements.surrenderBtn.disabled=!a),this.elements.doubleBtn){const l=i.status==="playing"&&e.balance>=i.bet&&i.cards.length===2;this.elements.doubleBtn.disabled=!l}}else this.elements.splitBtn&&(this.elements.splitBtn.style.display="none")}showHint(){if(!this.game)return;const e=this.game.getState();if(e.gameOver||!e.gameStarted)return;const t=e.playerHands[e.currentHandIndex],s=e.dealerHand[0],i=C.getBestMove(t,s),a={hit:"hit-btn",stand:"stand-btn",double:"double-btn",split:"split-btn",surrender:"surrender-btn"}[i];let l=null;i==="double"&&(l="hit-btn"),(i==="split"||i==="surrender")&&(l="hit-btn");let r=document.getElementById(a);(!r||r.style.display==="none"||r.disabled)&&l&&(r=document.getElementById(l)),r&&(this.clearHint(),r.classList.add("hint-active"),setTimeout(()=>r.classList.remove("hint-active"),2e3),this.showToast(`Sugestão: ${this.getMoveName(i)}`,"info",1500))}getMoveName(e){return{hit:"Pedir Carta",stand:"Parar",double:"Dobrar",split:"Dividir",surrender:"Desistir"}[e]||e}clearHint(){document.querySelectorAll(".hint-active").forEach(t=>t.classList.remove("hint-active"))}renderHand(e,t,s,i){if(e){if(!t||t.length===0){e.innerHTML="";return}for(t.forEach((n,a)=>{const l=s&&a===1&&!i;let r=e.children[a];if(r){const o=r.querySelector(".value")?.textContent,c=r.querySelector(".suit")?.textContent;if(o!==n.value||c!==n.suit){const u=this.createCardElement(n,l);this.animationsEnabled&&(u.style.animationDelay=`${a*.12}s`),e.replaceChild(u,r)}else l?r.classList.add("flipped"):r.classList.remove("flipped")}else r=this.createCardElement(n,l),this.animationsEnabled&&(r.style.animationDelay=`${a*.12}s`),e.appendChild(r)});e.children.length>t.length;)e.removeChild(e.lastChild)}}createCardElement(e,t=!1){const s=document.createElement("div");s.className="card",s.setAttribute("role","img"),t&&s.classList.add("flipped");const n={"♠":"Espadas","♥":"Copas","♦":"Ouros","♣":"Paus"}[e.suit]||e.suit;s.setAttribute("aria-label",t?"Carta virada":`${e.value} de ${n}`);const a=document.createElement("div");a.className="card-inner";const l=document.createElement("div"),r=e.suit==="♥"||e.suit==="♦";l.className=`card-face card-front ${r?"red":"black"}`;const o=document.createElement("div");o.className="suit",o.textContent=e.suit;const c=document.createElement("div");c.className="suit-bottom",c.textContent=e.suit;const u=document.createElement("div");u.className="value",u.textContent=e.value,l.appendChild(o),l.appendChild(c),l.appendChild(u);const f=document.createElement("div");return f.className="card-face card-back",f.setAttribute("aria-hidden","true"),a.appendChild(l),a.appendChild(f),s.appendChild(a),s}renderPlayerHands(e,t){const s=this.elements.playerCards;if(s){if(!e||e.length===0){s.innerHTML="";return}if(e.length===1){s.firstChild&&s.firstChild.classList&&s.firstChild.classList.contains("hand-container")&&(s.innerHTML=""),this.renderHand(s,e[0].cards,!1,!1);return}for(e.forEach((i,n)=>{let a=s.children[n];if(!a||!a.classList.contains("hand-container")){a=document.createElement("div"),a.className="hand-container";const o=document.createElement("div");o.className="hand-info",a.appendChild(o);const c=document.createElement("div");c.className="hand-cards-inner",c.style.display="flex",c.style.gap="10px",c.style.justifyContent="center",c.style.flexWrap="wrap",a.appendChild(c),s.children[n]?s.replaceChild(a,s.children[n]):s.appendChild(a)}a.classList.toggle("active-hand",n===t);const l=a.querySelector(".hand-info");l&&(l.textContent=`$${i.bet}`);const r=a.querySelector(".hand-cards-inner")||a.lastElementChild;this.renderHand(r,i.cards,!1,!1)});s.children.length>e.length;)s.removeChild(s.lastChild)}}toggleGameControls(e){this.elements.betControls&&(this.elements.betControls.style.display=e?"none":"flex"),this.elements.gameControls&&(this.elements.gameControls.style.display=e?"flex":"none"),this.elements.newGameBtn&&(this.elements.newGameBtn.style.display="none"),this.elements.rebetBtn&&(this.elements.rebetBtn.style.display="none")}showNewGameButton(){this.elements.newGameBtn&&(this.elements.newGameBtn.style.display="inline-block"),this.elements.rebetBtn&&this.game&&this.game.balance>=this.game.currentBet&&(this.elements.rebetBtn.style.display="inline-block")}showMessage(e,t){this.elements.message&&(this.elements.message.textContent=e,this.elements.message.className=`message ${t}`)}toggleLoading(e){this.elements.loading&&(this.elements.loading.style.display=e?"block":"none")}hideWelcomeScreen(){this.elements.welcomeScreen&&(this.elements.welcomeScreen.classList.add("hidden"),setTimeout(()=>{this.elements.welcomeScreen.style.display="none"},500))}toggleSettingsModal(e){this.elements.settingsModal&&(this.elements.settingsModal.style.display=e?"block":"none")}toggleInsuranceModal(e){this.elements.insuranceModal&&(this.elements.insuranceModal.style.display=e?"block":"none")}setAnimationsEnabled(e){this.animationsEnabled=e}setStatsVisibility(e){this.elements.statsContainer&&(this.elements.statsContainer.style.display=e?"block":"none")}setVolume(e){const t=Math.round(e*100);this.elements.volumeSlider&&(this.elements.volumeSlider.value=t),this.elements.volumeValue&&(this.elements.volumeValue.textContent=`${t}%`)}setTheme(e){document.body.classList.add("theme-transition"),e==="light"?document.body.classList.add("theme-light"):document.body.classList.remove("theme-light"),this.elements.themeDark&&this.elements.themeDark.classList.toggle("active",e!=="light"),this.elements.themeLight&&this.elements.themeLight.classList.toggle("active",e==="light"),this.game&&this.game.updateSetting("theme",e),setTimeout(()=>document.body.classList.remove("theme-transition"),350)}showWinAnimation(e){this.animationsEnabled&&this.drawConfetti()}setupConfettiCanvas(){let e=document.getElementById("confetti-canvas");return e||(e=document.createElement("canvas"),e.id="confetti-canvas",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="9999",document.body.appendChild(e),window.addEventListener("resize",()=>{e.width=window.innerWidth,e.height=window.innerHeight})),e.width=window.innerWidth,e.height=window.innerHeight,e}drawConfetti(){this.confettiAnimationId&&cancelAnimationFrame(this.confettiAnimationId);const e=this.setupConfettiCanvas(),t=e.getContext("2d"),s=[],i=150,n=["#FFD700","#FFA500","#2ecc71","#3498db","#e74c3c","#ffffff"];for(let l=0;l<i;l++)s.push({x:Math.random()*e.width,y:Math.random()*e.height-e.height,vx:Math.random()*4-2,vy:Math.random()*5+2,color:n[Math.floor(Math.random()*n.length)],size:Math.random()*8+4,rotation:Math.random()*360,rotationSpeed:Math.random()*4-2});const a=()=>{t.clearRect(0,0,e.width,e.height);let l=0;s.forEach(r=>{r.y+=r.vy,r.x+=r.vx,r.rotation+=r.rotationSpeed,r.vy+=.05,r.y<e.height&&(l++,t.save(),t.translate(r.x,r.y),t.rotate(r.rotation*Math.PI/180),t.fillStyle=r.color,t.fillRect(-r.size/2,-r.size/2,r.size,r.size),t.restore())}),l>0?this.confettiAnimationId=requestAnimationFrame(a):(t.clearRect(0,0,e.width,e.height),cancelAnimationFrame(this.confettiAnimationId),this.confettiAnimationId=null)};a()}showError(e){this.elements.errorMessage&&(this.elements.errorMessage.textContent=e),this.elements.errorNotification&&this.elements.errorNotification.classList.add("show"),setTimeout(()=>this.hideError(),5e3)}hideError(){this.elements.errorNotification&&this.elements.errorNotification.classList.remove("show")}showToast(e,t="info",s=3e3){const i=this.elements.toastContainer;if(!i)return;const n=document.createElement("div");for(n.className=`toast ${t}`,n.textContent=e,n.style.animationDuration="0.3s, 0.3s",n.style.animationDelay=`0s, ${(s-300)/1e3}s`,i.appendChild(n);i.children.length>5;)i.removeChild(i.firstChild);setTimeout(()=>{n.parentNode&&n.remove()},s)}showShuffleAnimation(){if(!this.animationsEnabled)return;const e=document.querySelector(".game-area");if(!e)return;const t=document.createElement("div");t.className="shuffle-overlay";const s=document.createElement("div");s.className="shuffle-cards";for(let i=0;i<3;i++){const n=document.createElement("div");n.className="shuffle-card",s.appendChild(n)}t.appendChild(s),e.style.position="relative",e.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},1300)}updateShoeIndicator(e,t){if(!this.elements.shoeBar||!this.elements.shoeLabel)return;const s=t>0?Math.round(e/t*100):100;this.elements.shoeBar.style.setProperty("--shoe-pct",`${s}%`),this.elements.shoeLabel.textContent=`${s}%`}updateStats(e,t,s,i){const n=e+t,a=n>0?Math.round(e/n*100):0;this.elements.totalGames&&this.animateValue(this.elements.totalGames,n),this.elements.winRate&&this.animateValue(this.elements.winRate,a,"","%"),this.elements.totalWinnings&&this.animateValue(this.elements.totalWinnings,s,"$"),this.elements.blackjacks&&this.animateValue(this.elements.blackjacks,i)}animateValue(e,t,s="",i=""){if(!e)return;if(e.dataset.animId&&(cancelAnimationFrame(parseInt(e.dataset.animId)),delete e.dataset.animId),!this.animationsEnabled){e.textContent=`${s}${t}${i}`;return}const n=e.textContent.replace(/[^0-9.-]/g,"");let a=parseInt(n);if(isNaN(a)&&(a=0),a===t){e.textContent=`${s}${t}${i}`;return}const l=500,r=performance.now(),o=c=>{const u=c-r,f=Math.min(u/l,1),w=1-Math.pow(1-f,3),I=Math.round(a+(t-a)*w);e.textContent=`${s}${I}${i}`,f<1?e.dataset.animId=requestAnimationFrame(o):(e.textContent=`${s}${t}${i}`,delete e.dataset.animId)};e.dataset.animId=requestAnimationFrame(o)}}class L{constructor(e=h.DECKS){this.numberOfDecks=e,this.cards=[],this.cutCardReached=!1,this.reset(),this.shuffle()}get totalCards(){return this.numberOfDecks*52}reset(){const e=["♠","♥","♦","♣"],t=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];this.cards=[];for(let n=0;n<this.numberOfDecks;n++)for(const a of e)for(const l of t)this.cards.push({suit:a,value:l});this.cutCardReached=!1;const s=Math.floor(this.totalCards*.2),i=Math.floor(this.totalCards*.4);this.cutCardPosition=s+this._getRandomInt(i-s)}get remainingCards(){return this.cards.length}get needsReshuffle(){return this.cutCardReached}shuffle(){const e=this.cards.length;for(let t=e-1;t>0;t--){const s=this._getRandomInt(t+1);[this.cards[t],this.cards[s]]=[this.cards[s],this.cards[t]]}}_getRandomInt(e){if(typeof crypto<"u"&&crypto.getRandomValues){const s=4294967296-4294967296%e,i=new Uint32Array(1);do crypto.getRandomValues(i);while(i[0]>=s);return i[0]%e}else return Math.floor(Math.random()*e)}draw(){return this.cards.length===0&&(this.reset(),this.shuffle()),this.cards.length<=this.cutCardPosition+1&&(this.cutCardReached=!0),this.cards.pop()}}class H{constructor(){this.deck=new L,this.resetState()}resetState(){this.playerHands=[],this.dealerHand=[],this.currentHandIndex=0,this.dealerRevealed=!1,this.gameStarted=!1,this.gameOver=!1,this.insuranceTaken=!1}shuffleDeck(){this.deck.reset(),this.deck.shuffle()}startGame(e){this.deck.needsReshuffle&&this.shuffleDeck(),this.resetState(),this.gameStarted=!0;const t=this.deck.draw(),s=this.deck.draw(),i=this.deck.draw(),n=this.deck.draw();return this.playerHands=[{cards:[t,s],bet:e,status:"playing",splitFromAces:!1}],this.dealerHand=[i,n],{playerHands:this.playerHands,dealerHand:this.dealerHand}}get dealerUpCard(){return this.dealerHand[0]}hit(e){const t=this.playerHands[e];if(!t||t.status!=="playing")return null;const s=this.deck.draw();t.cards.push(s);const i=m(t.cards);return i>21?t.status="busted":i===21&&(t.status="stand"),{hand:t,card:s}}stand(e){const t=this.playerHands[e];return t?(t.status="stand",{hand:t}):null}double(e){const t=this.playerHands[e];if(!t||t.status!=="playing")return null;const s=this.deck.draw();return t.cards.push(s),t.bet*=2,m(t.cards)>21?t.status="busted":t.status="stand",{hand:t,card:s}}split(e){const t=this.playerHands[e];if(!t||t.cards.length!==2||t.cards[0].value!==t.cards[1].value||t.splitFromAces)return null;const s=t.cards[0].value==="A",n={cards:[t.cards.pop()],bet:t.bet,status:"playing",splitFromAces:s};return t.cards.push(this.deck.draw()),n.cards.push(this.deck.draw()),t.splitFromAces=s,this.playerHands.splice(e+1,0,n),s&&(t.status="stand",n.status="stand"),{handIndex:e,newHandIndex:e+1,isSplittingAces:s}}surrender(e){const t=this.playerHands[e];return!t||this.playerHands.length>1||t.cards.length!==2?null:(t.status="surrender",{hand:t})}dealerShouldHit(){const e=m(this.dealerHand),t=S(this.dealerHand);return e<17||e===17&&t}dealerHit(){if(this.dealerShouldHit()){const e=this.deck.draw();return this.dealerHand.push(e),e}return null}dealerTurn(){this.dealerRevealed=!0;const e=[];for(;this.dealerShouldHit();){const t=this.dealerHit();t&&e.push(t)}return{dealerHand:this.dealerHand,cardsDrawn:e}}evaluateResults(){const e=m(this.dealerHand),t=v(this.dealerHand,1),s=this.playerHands.map(i=>{const n=m(i.cards),a=v(i.cards,this.playerHands.length);let l="lose",r=0;return i.status==="surrender"?(l="surrender",r=.5):i.status==="busted"?(l="lose",r=0):t?a?(l="tie",r=1):(l="lose",r=0):e>21?(l="win",r=2,a&&(r=h.PAYOUT.BLACKJACK)):a?(l="win",r=h.PAYOUT.BLACKJACK):n>e?(l="win",r=2):n===e?(l="tie",r=1):(l="lose",r=0),{hand:i,result:l,winMultiplier:r,payout:Math.floor(i.bet*r)}});return{dealerValue:e,dealerBJ:t,results:s}}getState(){return{playerHands:this.playerHands,dealerHand:this.dealerHand,currentHandIndex:this.currentHandIndex,dealerRevealed:this.dealerRevealed,gameStarted:this.gameStarted,gameOver:this.gameOver,remainingCards:this.deck.remainingCards,totalCards:this.deck.totalCards}}}class g{static set(e,t){try{if(typeof Storage<"u"){const s=g.encode(t);return localStorage.setItem(e,s),!0}}catch(s){if(s.name==="QuotaExceededError"||s.code===22)return console.warn("LocalStorage quota exceeded"),!1;console.warn("LocalStorage not available:",s.message)}return!1}static get(e){try{if(typeof Storage<"u"){const t=localStorage.getItem(e);return t===null?null:g.decode(t)}}catch(t){console.warn("LocalStorage not available:",t.message)}return null}static remove(e){try{if(typeof Storage<"u")return localStorage.removeItem(e),!0}catch(t){console.warn("LocalStorage not available:",t.message)}return!1}static encode(e){try{const t=g.checksum(e),s=JSON.stringify({d:e,c:t});return btoa(unescape(encodeURIComponent(s)))}catch{return e}}static decode(e){try{const t=decodeURIComponent(escape(atob(e))),{d:s,c:i}=JSON.parse(t);return g.checksum(s)!==i&&console.warn("Storage data checksum mismatch - data may have been tampered"),s}catch{return e}}static checksum(e){let t=0;const s=typeof e=="string"?e:JSON.stringify(e);for(let i=0;i<s.length;i++){const n=s.charCodeAt(i);t=(t<<5)-t+n,t|=0}return t}static getUsedSpace(){try{let e=0;for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);e+=s.length+localStorage.getItem(s).length}return e*2}catch{return 0}}static isSpaceAvailable(e=1024){try{const t="__storage_test__",s="x".repeat(e);return localStorage.setItem(t,s),localStorage.removeItem(t),!0}catch{return!1}}}class x{constructor(){this._listeners={}}on(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),this}off(e,t){return this._listeners[e]?(this._listeners[e]=this._listeners[e].filter(s=>s!==t),this):this}once(e,t){const s=(...i)=>{t(...i),this.off(e,s)};return this.on(e,s)}emit(e,...t){return this._listeners[e]?(this._listeners[e].forEach(s=>s(...t)),!0):!1}}class p{static instance=null;static getInstance(e,t){return p.instance||(p.instance=new p(e,t)),p.instance}constructor(e,t){if(p.instance)return p.instance;this.events=new x,this.ui=e,this.soundManager=t,this.engine=new H,this.username=null,this.initializeGameState(),this.initializeSettings(),this.timeouts=[],this.saveGame=B(this._saveGameImmediate.bind(this),1e3)}get playerHands(){return this.engine.playerHands}set playerHands(e){this.engine.playerHands=e}get dealerHand(){return this.engine.dealerHand}set dealerHand(e){this.engine.dealerHand=e}get currentHandIndex(){return this.engine.currentHandIndex}set currentHandIndex(e){this.engine.currentHandIndex=e}get dealerRevealed(){return this.engine.dealerRevealed}set dealerRevealed(e){this.engine.dealerRevealed=e}get gameStarted(){return this.engine.gameStarted}set gameStarted(e){this.engine.gameStarted=e}get gameOver(){return this.engine.gameOver}set gameOver(e){this.engine.gameOver=e}get insuranceTaken(){return this.engine.insuranceTaken}set insuranceTaken(e){this.engine.insuranceTaken=e}get deck(){return this.engine.deck}set deck(e){this.engine.deck=e}login(e){this.username=e,this.loadGame(),this.loadSettings(),this.updateUI()}getStorageKey(e){return this.username?`${e}-${this.username}`:null}addTimeout(e,t){const s=setTimeout(e,t);return this.timeouts.push(s),s}clearTimeouts(){this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts=[]}initializeGameState(){this.balance=h.INITIAL_BALANCE,this.currentBet=50,this.wins=0,this.losses=0,this.blackjacks=0,this.totalWinnings=0,this.engine.resetState(),this.timeouts=[]}initializeSettings(){this.settings={soundEnabled:!0,animationsEnabled:!0,autoSave:!0,showStats:!1,volume:.5,theme:"dark"}}getState(){const e=this.engine.getState();return{balance:this.balance,currentBet:this.currentBet,wins:this.wins,losses:this.losses,blackjacks:this.blackjacks,totalWinnings:this.totalWinnings,playerHands:e.playerHands,currentHandIndex:e.currentHandIndex,dealerHand:e.dealerHand,dealerRevealed:e.dealerRevealed,gameOver:e.gameOver,gameStarted:e.gameStarted,settings:this.settings}}startApp(){this.events.emit("app:start"),this.ui&&(this.ui.hideWelcomeScreen(),this.ui.toggleLoading(!0),setTimeout(()=>{this.ui.toggleLoading(!1),this.updateUI()},h.DELAYS.LOADING))}_saveGameImmediate(){if(!this.username)return;const e={version:h.STORAGE_VERSION,balance:this.balance,wins:this.wins,losses:this.losses,blackjacks:this.blackjacks,totalWinnings:this.totalWinnings,gameStarted:this.engine.gameStarted};g.set(this.getStorageKey("blackjack-premium-save"),JSON.stringify(e))}migrateData(e){return(!e.version||e.version<h.STORAGE_VERSION)&&(e.version=h.STORAGE_VERSION),e}loadGame(){if(!this.username)return;const e=g.get(this.getStorageKey("blackjack-premium-save"));if(e)try{let t=JSON.parse(e);t=this.migrateData(t),this.balance=t.balance||1e3,this.wins=t.wins||0,this.losses=t.losses||0,this.blackjacks=t.blackjacks||0,this.totalWinnings=t.totalWinnings||0,t.gameStarted}catch{console.warn("Could not parse game state")}this.loadSettings()}saveSettings(){this.username&&g.set(this.getStorageKey("blackjack-premium-settings"),JSON.stringify(this.settings))}loadSettings(){if(!this.username)return;const e=g.get(this.getStorageKey("blackjack-premium-settings"));if(e)try{this.settings={...this.settings,...JSON.parse(e)},this.soundManager&&(this.soundManager.setEnabled(this.settings.soundEnabled),this.soundManager.setVolume(this.settings.volume)),this.ui&&(this.ui.setAnimationsEnabled(this.settings.animationsEnabled),this.ui.setStatsVisibility(this.settings.showStats),this.ui.setVolume(this.settings.volume),this.settings.theme&&this.ui.setTheme(this.settings.theme))}catch{console.warn("Could not parse settings")}}updateUI(){if(this.ui){this.ui.render(this.getState());const e=this.engine.getState();this.ui.updateShoeIndicator(e.remainingCards,e.totalCards)}}adjustBet(e){const t=Math.max(10,Math.min(this.balance,this.currentBet+e));this.currentBet=t,this.soundManager&&this.soundManager.play("chip"),this.updateUI()}setBet(e){e<=this.balance&&(this.currentBet=Math.max(10,e),this.soundManager&&this.soundManager.play("chip"),this.updateUI())}multiplyBet(e){const t=Math.max(10,Math.min(this.balance,Math.floor(this.currentBet*e)));this.currentBet=t,this.soundManager&&this.soundManager.play("chip"),this.updateUI()}maxBet(){this.currentBet=this.balance,this.soundManager&&this.soundManager.play("chip"),this.updateUI()}startGame(){if(this.currentBet<10||this.currentBet>this.balance){this.ui&&this.ui.showMessage("Aposta inválida!","lose"),this.soundManager&&this.soundManager.play("lose");return}this.balance-=this.currentBet,this.engine.deck.needsReshuffle&&(this.events.emit("deck:shuffle"),this.ui&&(this.ui.showMessage("Embaralhando...",""),this.ui.showToast("Sapato reembaralhado","info",2e3)));const{dealerHand:e}=this.engine.startGame(this.currentBet);this.updateUI(),this.soundManager&&this.soundManager.play("card"),this.events.emit("game:started",this.getState()),this.ui&&(this.ui.toggleGameControls(!1),this.ui.showMessage("Boa sorte!"));const t=e[0],s=b(t);t.value==="A"?setTimeout(()=>{this.ui&&this.ui.toggleInsuranceModal(!0)},h.DELAYS.INSURANCE_MODAL):s===10?this.addTimeout(()=>this.checkDealerBlackjack(),h.DELAYS.DEAL):this.addTimeout(()=>this.startPlayerTurn(),h.DELAYS.DEAL)}startPlayerTurn(){this.ui&&(this.ui.toggleGameControls(!0),this.ui.showMessage("Sua vez!")),this.updateUI(),m(this.engine.playerHands[0].cards)===21&&this.addTimeout(()=>this.endGame(),h.DELAYS.TURN)}checkDealerBlackjack(){m(this.engine.dealerHand)===21&&this.engine.dealerHand.length===2?(this.engine.dealerRevealed=!0,this.updateUI(),this.ui&&this.ui.showMessage("Dealer tem Blackjack!","lose"),this.addTimeout(()=>this.endGame(),h.DELAYS.GAME_OVER)):(this.ui&&this.ui.showMessage("Dealer não tem Blackjack.",""),this.addTimeout(()=>this.startPlayerTurn(),h.DELAYS.TURN))}respondToInsurance(e){if(this.ui&&this.ui.toggleInsuranceModal(!1),e){const t=Math.floor(this.currentBet/2);this.balance>=t?(this.balance-=t,this.engine.insuranceTaken=!0,this.ui&&this.ui.showMessage("Seguro apostado.",""),this.soundManager&&this.soundManager.play("chip")):this.ui&&this.ui.showMessage("Saldo insuficiente para seguro.","lose")}else this.ui&&this.ui.showMessage("Seguro recusado.","");this.updateUI(),this.addTimeout(()=>this.checkDealerBlackjack(),h.DELAYS.TURN)}hit(){if(this.engine.gameOver)return;const e=this.engine.hit(this.engine.currentHandIndex);if(!e)return;const{hand:t}=e;this.soundManager&&this.soundManager.play("card"),this.events.emit("player:hit",{handIndex:this.engine.currentHandIndex,hand:t}),this.updateUI(),t.status==="busted"&&(this.events.emit("hand:bust",{handIndex:this.engine.currentHandIndex}),this.ui&&this.ui.showMessage("Estourou!","lose"),this.addTimeout(()=>this.nextHand(),h.DELAYS.NEXT_HAND))}stand(){this.engine.gameOver||(this.engine.stand(this.engine.currentHandIndex),this.events.emit("player:stand",{handIndex:this.engine.currentHandIndex}),this.nextHand())}double(){if(this.engine.gameOver)return;const e=this.engine.playerHands[this.engine.currentHandIndex];if(this.balance<e.bet)return;this.balance-=e.bet;const t=this.engine.double(this.engine.currentHandIndex);if(!t){this.balance+=e.bet;return}this.soundManager&&this.soundManager.play("card"),t.hand.status==="busted"&&this.ui&&this.ui.showMessage("Estourou!","lose"),this.updateUI(),this.addTimeout(()=>this.nextHand(),h.DELAYS.NEXT_HAND)}split(){if(this.engine.playerHands.length===0)return;const e=this.engine.playerHands[this.engine.currentHandIndex];if(this.balance<e.bet||this.engine.playerHands.length>h.MAX_SPLITS)return;const t=e.bet;this.balance-=t;const s=this.engine.split(this.engine.currentHandIndex);if(!s){this.balance+=t;return}this.soundManager&&this.soundManager.play("card"),this.events.emit("player:split",{handIndex:this.engine.currentHandIndex,isSplittingAces:s.isSplittingAces}),s.isSplittingAces?(this.updateUI(),this.addTimeout(()=>this.nextHand(),h.DELAYS.NEXT_HAND)):this.updateUI()}surrender(){this.engine.gameOver||this.engine.playerHands.length===0||!this.engine.surrender(this.engine.currentHandIndex)||(this.soundManager&&this.soundManager.play("chip"),this.ui&&this.ui.showMessage("Você desistiu.","tie"),this.endGame())}nextHand(){this.engine.currentHandIndex<this.engine.playerHands.length-1?(this.engine.currentHandIndex++,this.updateUI()):this.playDealer()}playDealer(){if(this.engine.playerHands.every(s=>s.status==="busted")){this.endGame();return}this.engine.dealerRevealed=!0,this.events.emit("dealer:turn"),this.updateUI();const t=()=>{this.engine.dealerShouldHit()?(this.engine.dealerHit(),this.soundManager&&this.soundManager.play("card"),this.updateUI(),this.addTimeout(t,h.DELAYS.DEALER_TURN)):this.addTimeout(()=>this.endGame(),h.DELAYS.NEXT_HAND)};this.addTimeout(t,h.DELAYS.DEALER_TURN)}endGame(){this.engine.gameOver=!0,this.engine.dealerRevealed=!0,this.events.emit("game:ending");const{dealerValue:e,dealerBJ:t,results:s}=this.engine.evaluateResults();if(this.engine.insuranceTaken&&t){const c=Math.floor(this.currentBet/2)*h.PAYOUT.INSURANCE;this.balance+=c,this.totalWinnings+=c-Math.floor(this.currentBet/2),this.ui&&this.ui.showMessage("Seguro paga 2:1!","win")}let i=0,n=!1,a=!0;s.forEach(({hand:c,result:u,payout:f})=>{v(c.cards,this.engine.playerHands.length)&&u==="win"&&this.blackjacks++,u==="win"?(this.wins++,n=!0):(u==="lose"||u==="surrender")&&this.losses++,i+=f,u!=="lose"&&(a=!1)}),this.balance+=i;const l=this.engine.playerHands.reduce((c,u)=>c+u.bet,0);this.totalWinnings+=i-l;let r="",o="";if(this.engine.playerHands.length===1){const c=this.engine.playerHands[0],u=m(c.cards);c.status==="surrender"?(r="Você desistiu.",o="tie"):c.status==="busted"?(r="Você estourou! Dealer vence!",o="lose"):e>21?(r="Dealer estourou! Você venceu!",o="win"):u>e?(i>c.bet*2?r="BLACKJACK! Você venceu!":r="Você venceu!",o="win"):e>u?(r="Dealer vence!",o="lose"):(r="Empate!",o="tie")}else i>0?(r=`Ganhou $${i}!`,o="win"):(r="Dealer venceu todas!",o="lose");n?(this.soundManager&&this.soundManager.play("win"),this.ui&&this.ui.showWinAnimation(i)):a&&this.soundManager&&this.soundManager.play("lose"),this.ui&&(this.ui.showMessage(r,o),this.ui.showNewGameButton(),this.ui.toggleGameControls(!1)),this.updateUI(),this.balance<10&&setTimeout(()=>{this.resetGame()},h.DELAYS.RESET),this.events.emit("game:over",{message:r,messageClass:o,totalWin:i,anyWin:n,allLost:a}),this.settings.autoSave&&this.saveGame()}resetGame(){this.balance=h.INITIAL_BALANCE,this.wins=0,this.losses=0,this.blackjacks=0,this.totalWinnings=0,this.newGame(),this.ui&&(this.ui.showMessage("Jogo reiniciado!","win"),this.ui.showToast("Jogo reiniciado com sucesso","success")),this.saveGame()}newGame(){this.engine.resetState(),this.currentBet>this.balance&&(this.currentBet=Math.max(10,this.balance)),this.ui&&(this.ui.toggleGameControls(!1),this.ui.showMessage("Escolha sua aposta!")),this.updateUI()}rebetAndDeal(){this.engine.resetState(),this.currentBet>this.balance&&(this.currentBet=Math.max(10,this.balance)),this.startGame()}exportData(){if(!this.username)return;const e={username:this.username,version:1,exportedAt:new Date().toISOString(),gameState:{balance:this.balance,wins:this.wins,losses:this.losses,blackjacks:this.blackjacks,totalWinnings:this.totalWinnings},settings:this.settings},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=`blackjack-${this.username}-${new Date().toISOString().slice(0,10)}.json`,i.click(),URL.revokeObjectURL(s)}importData(e){const t=new FileReader;t.onload=s=>{try{const i=JSON.parse(s.target.result);if(!i.gameState||!i.version){this.ui&&this.ui.showError("Arquivo inválido.");return}const n=i.gameState;this.balance=n.balance||h.INITIAL_BALANCE,this.wins=n.wins||0,this.losses=n.losses||0,this.blackjacks=n.blackjacks||0,this.totalWinnings=n.totalWinnings||0,i.settings&&(this.settings={...this.settings,...i.settings},this.loadSettings()),this.newGame(),this.saveGame(),this.ui&&this.ui.showMessage("Dados importados!","win")}catch{this.ui&&this.ui.showError("Erro ao importar dados.")}},t.readAsText(e)}updateSetting(e,t){e in this.settings&&(this.settings[e]=t,e==="soundEnabled"&&this.soundManager&&this.soundManager.setEnabled(t),e==="volume"&&this.soundManager&&this.soundManager.setVolume(t),this.ui&&(e==="animationsEnabled"&&this.ui.setAnimationsEnabled(t),e==="showStats"&&this.ui.setStatsVisibility(t),e==="theme"&&this.ui.setTheme(t)),this.saveSettings())}}class M{constructor(e=!0){this.enabled=e,this.volume=.5,this.context=null,this.buffers={},this.initialized=!1,this.maxConcurrent=5,this.activeSources=[],this.soundConfig={card:[],chip:[],win:[],lose:[],button:[]},this.synthSounds={card:{frequency:800,duration:.1},win:{frequency:523.25,duration:.3},lose:{frequency:220,duration:.5},chip:{frequency:1e3,duration:.05},button:{frequency:600,duration:.08}}}async ensureInitialized(){if(!this.initialized){this.initialized=!0;try{const e=window.AudioContext||window.webkitAudioContext;if(!e){console.warn("Web Audio API not supported");return}this.context=new e,this.preloadSounds()}catch(e){console.warn("Failed to initialize SoundManager:",e)}}}async preloadSounds(){if(!this.context)return;const e=[];for(const[t,s]of Object.entries(this.soundConfig))this.buffers[t]=[],s.forEach(i=>{const n=fetch(i).then(a=>{if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.arrayBuffer()}).then(a=>this.context.decodeAudioData(a)).then(a=>{this.buffers[t].push(a)}).catch(a=>{console.warn(`Failed to load sound ${i}: ${a.message}`)});e.push(n)});await Promise.all(e)}setEnabled(e){this.enabled=e,e&&this.context&&this.context.state==="suspended"&&this.context.resume().catch(()=>{})}setVolume(e){this.volume=Math.max(0,Math.min(1,e))}play(e){if(!this.enabled||(this.ensureInitialized(),!this.context))return;if(this.context.state==="suspended"&&this.context.resume().catch(()=>{}),this.cleanupSources(),this.activeSources.length>=this.maxConcurrent){const s=this.activeSources.shift();try{s.stop()}catch{}}const t=this.buffers[e];t&&t.length>0?this.playSample(t):this.playSynthetic(e)}cleanupSources(){this.activeSources=this.activeSources.filter(e=>{try{return e.playbackState!=="finished"}catch{return!1}})}playSample(e){try{const t=e[Math.floor(Math.random()*e.length)],s=this.context.createBufferSource();s.buffer=t;const i=this.context.createGain();i.gain.value=this.volume,s.connect(i),i.connect(this.context.destination),s.onended=()=>{const n=this.activeSources.indexOf(s);n>-1&&this.activeSources.splice(n,1)},s.start(0),this.activeSources.push(s)}catch(t){console.warn("Error playing sample:",t)}}playSynthetic(e){try{const t=this.context.currentTime,s=this.volume*.2;if(e==="card"){const i=this.context.sampleRate*.08,n=this.context.createBuffer(1,i,this.context.sampleRate),a=n.getChannelData(0);for(let c=0;c<i;c++)a[c]=Math.random()*2-1;const l=this.context.createBufferSource();l.buffer=n;const r=this.context.createBiquadFilter();r.type="highpass",r.frequency.value=3e3;const o=this.context.createGain();o.gain.setValueAtTime(s,t),o.gain.exponentialRampToValueAtTime(.01,t+.08),l.connect(r),r.connect(o),o.connect(this.context.destination),l.start(t)}else if(e==="win")[523.25,659.25,783.99].forEach((n,a)=>{const l=this.context.createOscillator(),r=this.context.createGain();l.type="triangle",l.frequency.value=n,l.connect(r),r.connect(this.context.destination);const o=t+a*.12;r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(s,o+.03),r.gain.exponentialRampToValueAtTime(.01,o+.25),l.start(o),l.stop(o+.25)});else if(e==="lose"){const i=this.context.createOscillator(),n=this.context.createGain();i.type="sine",i.frequency.setValueAtTime(400,t),i.frequency.linearRampToValueAtTime(200,t+.4),i.connect(n),n.connect(this.context.destination),n.gain.setValueAtTime(s,t),n.gain.exponentialRampToValueAtTime(.01,t+.5),i.start(t),i.stop(t+.5)}else if(e==="chip")[1200,1800].forEach((i,n)=>{const a=this.context.createOscillator(),l=this.context.createGain();a.type="square",a.frequency.value=i,a.connect(l),l.connect(this.context.destination);const r=t+n*.03;l.gain.setValueAtTime(s*.6,r),l.gain.exponentialRampToValueAtTime(.01,r+.04),a.start(r),a.stop(r+.04)});else{const i=this.synthSounds[e]||this.synthSounds.button;if(!i)return;const n=this.context.createOscillator(),a=this.context.createGain();n.frequency.value=i.frequency,n.connect(a),a.connect(this.context.destination),a.gain.setValueAtTime(s,t),a.gain.exponentialRampToValueAtTime(.01,t+i.duration),n.start(t),n.stop(t+i.duration)}}catch(t){console.warn("Error playing synthetic sound:",t)}}playRandom(e){this.play(e)}}let y=null;document.addEventListener("DOMContentLoaded",()=>{try{const d=new M,e=new A;y=p.getInstance(e,d),e.initialize(y),y.events.on("deck:shuffle",()=>e.showShuffleAnimation()),(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(window.__game=y,window.__HandUtils=k)}catch(d){console.error("Critical initialization error:",d)}});window.addEventListener("error",function(d){console.warn("JavaScript Error:",d.error),y&&y.ui&&y.ui.showError("Erro detectado. O jogo continuará funcionando.")});
